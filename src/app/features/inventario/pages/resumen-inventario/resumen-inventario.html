<div class="inventario-page">
  <!-- Filtros -->
  <div class="card filtros-card">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div class="btn-group" role="group">
        <button
          type="button"
          class="btn filtro-btn"
          [class.active]="filtro === 'todos'"
          (click)="cambiarFiltro('todos')"
        >
          <i class="fas fa-layer-group mr-1"></i>Todos
        </button>
        <button
          type="button"
          class="btn filtro-btn"
          [class.active]="filtro === 'disponibles'"
          (click)="cambiarFiltro('disponibles')"
        >
          <i class="fas fa-check-circle mr-1"></i>Disponibles
        </button>
        <button
          type="button"
          class="btn filtro-btn"
          [class.active]="filtro === 'bajo'"
          (click)="cambiarFiltro('bajo')"
        >
          <i class="fas fa-exclamation-triangle mr-1"></i>Stock Bajo
        </button>
        <button
          type="button"
          class="btn filtro-btn"
          [class.active]="filtro === 'agotados'"
          (click)="cambiarFiltro('agotados')"
        >
          <i class="fas fa-times-circle mr-1"></i>Agotados
        </button>
      </div>

      <!-- Botón agregar producto -->
      <a routerLink="/inventario/agregar" class="btn btn-sm btn-dark">
        <i class="fas fa-plus mr-1"></i>Agregar producto
      </a>
    </div>

    <p class="mt-2 mb-1 font-weight-bold">Mostrando:</p>

    <div class="table-responsive">
      <table class="table table-borderless mb-0">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Categoría</th>
            <th class="text-right">Cantidad</th>
            <th class="text-right">Precio</th>
            <th>Estado</th>
            <th class="text-right">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <!-- Filas con productos -->
          <tr *ngFor="let p of productosFiltrados">
            <td>{{ p.nombre }}</td>
            <td>{{ p.categoria || '—' }}</td>
            <td class="text-right">{{ p.stock }}</td>
            <td class="text-right">
              {{ p.precio != null ? ('$ ' + p.precio) : '—' }}
            </td>
            <td>
              <span
                class="badge"
                [ngClass]="{
                  'badge-success': p.stock > (p.min ?? 0),
                  'badge-warning': p.stock > 0 && p.stock <= (p.min ?? 0),
                  'badge-secondary': p.stock === 0
                }"
              >
                {{
                  p.stock === 0
                    ? 'Agotado'
                    : p.stock <= (p.min ?? 0)
                      ? 'Stock Bajo'
                      : 'Disponible'
                }}
              </span>
            </td>
            <td class="text-right">
              <!-- ACCIONES -->
              <button
                type="button"
                class="btn btn-sm btn-outline-primary mr-2"
                (click)="editarProducto(p)"
              >
                <i class="fas fa-pen mr-1"></i>Editar
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline-danger"
                (click)="eliminarProducto(p)"
              >
                <i class="fas fa-trash-alt mr-1"></i>Eliminar
              </button>
            </td>
          </tr>

          <!-- Estado vacío para el filtro actual -->
          <tr *ngIf="productosFiltrados.length === 0">
            <td colspan="6" class="text-center text-muted py-4">
              No hay productos para este filtro.
              <br />
              <a routerLink="/inventario/agregar" class="btn btn-sm btn-link">
                <i class="fas fa-plus mr-1"></i>Agregar el primer producto
              </a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Resumen inferior -->
  <div class="card resumen-card mt-3">
    <div class="row text-center">
      <div class="col">
        <div class="resumen-label">Total Productos</div>
        <div class="resumen-value">{{ totalProductos }}</div>
      </div>
      <div class="col">
        <div class="resumen-label">En Stock</div>
        <div class="resumen-value">{{ totalEnStock }}</div>
      </div>
      <div class="col">
        <div class="resumen-label">Stock Bajo</div>
        <div class="resumen-value">{{ totalStockBajo }}</div>
      </div>
      <div class="col">
        <div class="resumen-label">Agotados</div>
        <div class="resumen-value">{{ totalAgotados }}</div>
      </div>
    </div>
  </div>
</div>
